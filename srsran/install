# vim:syntax=sh:

# Create a temporary working directory
temp=$(mktemp -d)
trap 'rm -rf "$temp"' EXIT

sudo pacman -S doxygen
sudo pacman -S help2man
sudo pacman -S libusb
sudo pacman -S mbedtls
sudo pacman -S boost
sudo pacman -S lksctp-tools
sudo pacman -S libconfig

wget -nv -O $HOME/hostedxA9-latest.rbf https://www.nuand.com/fpga/hostedxA9-latest.rbf
wget -nv -O $HOME/bladeRF_fw_latest.img https://www.nuand.com/fx3/bladeRF_fw_latest.img

# Build and install bladeRF from source
cd "$temp"
git clone https://github.com/Nuand/bladeRF.git
cd bladeRF/host
mkdir -p build
cd build
cmake -DBUILD_DOCUMENTATION=ON -DENABLE_BACKEND_LIBUSB=ON ../
make -j$(nproc)
sudo make install
sudo ldconfig

# Build and install srsRAN_4G from source
cd "$temp"
git clone https://github.com/srsRAN/srsRAN_4G.git
cd srsRAN_4G
mkdir build
cd build
cmake ../
make -j$(nproc)
sudo make install
sudo ldconfig

echo "Executing default 4G config from $PWD..."
sudo $temp/srsRAN_4G/build/srsran_install_configs.sh user
$temp/srsRAN_4G/build/srsran_install_configs.sh user
echo "...done."
